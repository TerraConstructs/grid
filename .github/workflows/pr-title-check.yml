name: PR Title Check

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

permissions:
  pull-requests: read

jobs:
  validate-title:
    name: Validate PR Title
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/github-script@v8
        with:
          script: |
            const title = context.payload.pull_request.title;

            // Conventional commit pattern with optional scope and breaking change marker
            // Examples:
            // - feat: add user authentication
            // - fix(grid-a1b2): resolve state locking issue
            // - chore!: breaking change in API
            const pattern = /^(feat|fix|chore|docs|refactor|test|ci|style|revert)(\([a-z0-9-]+\))?(!)?: .+$/;

            if (!pattern.test(title)) {
              core.setFailed(
                `PR title "${title}" does not follow conventional commit format.\n\n` +
                `Expected format: type(scope)?: description\n\n` +
                `Valid types: feat, fix, chore, docs, refactor, test, ci, style, revert\n` +
                `Scope is optional but recommended (e.g., grid-xxxx for issue references)\n` +
                `Use ! before : to indicate breaking changes\n\n` +
                `Examples:\n` +
                `  - feat: add user authentication\n` +
                `  - fix(grid-a1b2): resolve state locking issue\n` +
                `  - chore!: breaking change in API`
              );
            } else {
              core.info(`âœ“ PR title follows conventional commit format`);
            }
