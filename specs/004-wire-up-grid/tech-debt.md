# Tech Debt

## Spec Analysis

### Specification Analysis Report I

| ID  | Category           | Severity | Location(s)                           | Summary                                                                                                                                                                      | Recommendation                                                                                                                     |
| --- | ------------------ | -------- | ------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| I1  | Inconsistency      | HIGH     | plan.md:2-48                          | Implementation plan is still the template with placeholders (summary, performance goals, constraints) and no feature-specific direction, making downstream tasks unreliable. | Populate plan.md with concrete summary, constraints, and sequencing from the spec/research before execution.                       |
| I2  | Inconsistency      | HIGH     | plan.md:97-100; data-model.md:214-238 | Plan claims a new edges table migration is required even though the schema already exists, risking duplicate or conflicting migrations.                                      | Remove/adjust the migration step in plan.md to reflect the existing schema and align with data-model.md.                           |
| I3  | Inconsistency      | HIGH     | spec.md:131-138; tasks.md:38,64       | Spec explicitly defers automatic polling, but tasks T013 and T035 add polling hooks, contradicting the agreed scope.                                                         | Update tasks to honor manual refresh only (or revise spec if polling is desired).                                                  |
| C1  | Coverage Gap       | HIGH     | spec.md:124-129; tasks.md             | No task ensures FR-019’s sensitive outputs are marked and redacted, leaving a security requirement uncovered.                                                                | Add a UI task/test to verify sensitive outputs render with indicators and without values.                                          |
| C2  | Coverage Gap       | HIGH     | spec.md:146-150; tasks.md             | Reconciliation guidance requirements (FR-031–FR-034) lack corresponding tasks or tests, so core dashboard insights may be omitted.                                           | Introduce tasks for presenting guidance, mock replacements, digest mismatches, and timestamps in DetailView plus associated tests. |
| C3  | Coverage Gap       | HIGH     | spec.md:139-145; tasks.md             | FR-030 (partial failure fallback) is not represented; current tasks focus on happy-path loading/error states only.                                                           | Add implementation/test tasks to cover partial success handling (e.g., one RPC fails) per requirement.                             |
| C4  | Coverage Gap       | MEDIUM   | spec.md:131-135; tasks.md             | No task ensures view context (selected state) is preserved during manual refresh, leaving FR-024 unmet.                                                                      | Extend hook/UI tasks to assert state preservation across refreshes.                                                                |
| C5  | Coverage Gap       | MEDIUM   | spec.md:152-156; tasks.md             | Read-only constraints (FR-035–FR-038) are not backed by checks or tests, risking inadvertent mutating UI affordances.                                                        | Add guardrail tasks/tests confirming no create/edit/delete/lock actions are exposed.                                               |
| A1  | Ambiguity          | MEDIUM   | spec.md:146-150                       | “Surface reconciliation guidance” and related guidance items lack specificity on content or UX, making implementation subjective.                                            | Refine spec with concrete guidance content/ examples or acceptance criteria before coding.                                         |
| U1  | Underspecification | MEDIUM   | spec.md                               | Non-functional requirements section is missing, so performance and accessibility expectations are undefined.                                                                 | Capture relevant NFRs (e.g., response latency, accessibility) in spec.md or flag as out-of-scope.                                  |
| O1  | Over-Scoping       | LOW      | tasks.md:74-76                        | T044 adds a repository benchmark without any specification driver, expanding scope beyond “minimal wiring.”                                                                  | Remove or defer T044 unless a performance NFR justifies it.                                                                        |

### Specification Analysis Report II

| ID                                                                                                                 | Category                                                                                                                                               | Severity | Location(s)                                                             | Summary                                                                                                                     | Recommendation                                                                   |
| ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- | ----------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| C1                                                                                                                 | Constitution                                                                                                                                           | CRITICAL | specs/004-wire-up-grid/tasks.md:30, .specify/memory/constitution.md:140 | Tasks waive the constitutionally mandated “tests first” rule by implementing adapters/UI before writing the specified       |
| T009–T016 tests.                                                                                                   | Reorder the plan so each affected task writes and runs failing tests before implementation (or add prerequisite test stubs) to restore TDD compliance. |
| I1                                                                                                                 | Inconsistency                                                                                                                                          | HIGH     | specs/004-wire-up-grid/spec.md:70, specs/004-wire-up-grid/spec.md:147   | Acceptance Scenario 7 promises reconciliation guidance while FR-031–FR-034 are deferred, creating conflicting expectations. |
| Either defer the scenario alongside the FRs or reinstate the reconciliation requirements with matching plan/tasks. |
| I2                                                                                                                 | Inconsistency                                                                                                                                          | HIGH     | specs/004-wire-up-grid/spec.md:94, specs/004-wire-up-grid/spec.md:144   | Edge-case guidance demands partial-failure fallback even though FR-030 marks it deferred.                                   | Decide whether partial-failure                                                   |
| handling is in-scope; update FR-030 and downstream plan/tasks accordingly.                                         |
| I3                                                                                                                 | Inconsistency                                                                                                                                          | HIGH     | specs/004-wire-up-grid/plan.md:87, specs/004-wire-up-grid/tasks.md:74   | Plan says to keep and modify webapp/src/services/mockApi.ts, but tasks call for deleting it.                                | Align plan and tasks: either                                                     |
| keep the mock (updating its interface) or document the removal rationale across artifacts.                         |
| G1                                                                                                                 | Coverage                                                                                                                                               | MEDIUM   | specs/004-wire-up-grid/spec.md:91                                       | Requirement to display lock-status indicators lacks any matching task or test.                                              | Add implementation/test tasks ensuring locked states render the required badge.  |
| G2                                                                                                                 | Coverage                                                                                                                                               | MEDIUM   | specs/004-wire-up-grid/spec.md:153                                      | Read-only constraints (FR-035–FR-038) have no explicit verification tasks.                                                  | Introduce regression tests or audits that confirm no mutation paths exist in the |
| updated UI/SDK.                                                                                                    |
| A1                                                                                                                 | Ambiguity                                                                                                                                              | MEDIUM   | specs/004-wire-up-grid/spec.md:141                                      | FR-027’s “handle network connectivity issues gracefully” gives no measurable criteria.                                      | Specify expected fallback behavior (e.g., cached data display, retry             |
| cadence) so tests can assert it.                                                                                   |

After implementation:

## Deferred Polish
- [ ] T043 [P] Add `js/sdk/test/errors.test.ts` covering error normalization edge cases (NotFound, Internal, fallback)
- [ ] T044 [P] (Deferred) Add repository benchmark `cmd/gridapi/internal/repository/list_all_edges_bench_test.go` measuring query latency for 1k edges
- [ ] T045 [P] Update `webapp/README.md` with instructions for running vitest scenarios, live API setup, and expected manual QA steps
